<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hospital GIS Data Collector</title>
  <!-- Telegram Web App script for Mini App integration -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <h1>Collect Hospital GIS Data</h1>
  <input type="text" id="hospitalName" placeholder="Hospital Name" required>
  <button onclick="getLocationAndSubmit()">Get Location & Submit</button>
  <p id="status"></p>

  <script>
    const tg = window.Telegram.WebApp;
    tg.ready(); // Initialize Telegram Mini App

    function getLocationAndSubmit() {
      if (!navigator.geolocation) {
        document.getElementById('status').innerText = 'Geolocation not supported.';
        return;
      }

      document.getElementById('status').innerText = 'Getting location...';
      navigator.geolocation.getCurrentPosition(sendData, showError);
    }

    async function sendData(position) {
      const hospitalName = document.getElementById('hospitalName').value;
      if (!hospitalName) {
        document.getElementById('status').innerText = 'Please enter a hospital name.';
        return;
      }

      const data = {
        hospitalName,
        latitude: position.coords.latitude,
        longitude: position.coords.longitude
      };
      console.log(data)
      try {
        const response = await fetch('/api/submit', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        const result = await response.json();
        document.getElementById('status').innerText = result.status === 'success' ? 'Data saved successfully!' : `Error: ${result.message}`;
        if (result.status === 'success' && tg.isExpanded) tg.close(); // Close Telegram Mini App on success
      } catch (error) {
        document.getElementById('status').innerText = `Error: ${error.message}`;
      }
    }

    function showError(error) {
      document.getElementById('status').innerText = `Location error: ${error.message}`;
    }
  </script>
</body>
</html>